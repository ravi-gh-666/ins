{% extends "base.html" %}
{% block content %}
<div class="container mx-auto max-w-4xl p-6 bg-white rounded-xl shadow mt-8">
    <div class="header bg-pink-700 text-white text-center text-4xl font-bold py-8 rounded-t-xl mb-8">
        Insurance Policy Scorecard
    </div>
    <form method="post" class="mb-8 flex flex-col md:flex-row gap-6 items-end">
        {{ form.hidden_tag() }}
        <div class="flex-1">
            {{ form.insurer.label(class="block text-lg font-semibold mb-2") }}
            {{ form.insurer(class="w-full rounded border border-gray-300 px-3 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-pink-600") }}
            {{ form.policy.label(class="block text-lg font-semibold mb-2") }}
            {{ form.policy(class="w-full rounded border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-600") }}
        </div>
        <button type="submit" class="bg-pink-700 text-white font-semibold py-3 px-8 rounded-lg hover:bg-pink-800 transition">View Scorecard</button>
    </form>
    {% if policy_data['InsurerDetails'] %}
    <div class="card bg-white rounded-lg shadow p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-8">
            <div class="flex-1">
                <h2 class="text-2xl font-bold mb-2">{{ policy_data['InsurerDetails']['InsurancePolicy'] }} by {{ policy_data['InsurerDetails']['Insurer'] }}</h2>
                <p class="mb-1"><strong>3 Year Average CSR:</strong> {{ policy_data['InsurerDetails']['ThreeYearAverageCSR']['Value'] }}
                    <span class="tag {{ get_score_color(policy_data['InsurerDetails']['ThreeYearAverageCSR']['Tag']) }} ml-2">{{ policy_data['InsurerDetails']['ThreeYearAverageCSR']['Tag'] }}</span>
                </p>
                <p class="mb-1"><strong>Network Hospitals:</strong> {{ policy_data['InsurerDetails']['NetworkHospitals']['Value'] }}
                    <span class="tag {{ get_score_color(policy_data['InsurerDetails']['NetworkHospitals']['Tag']) }} ml-2">{{ policy_data['InsurerDetails']['NetworkHospitals']['Tag'] }}</span>
                </p>
                <p class="mb-1"><strong>Volume of Complaints:</strong> {{ policy_data['InsurerDetails']['VolumeOfComplaints']['Value'] }}
                    <span class="tag {{ get_score_color(policy_data['InsurerDetails']['VolumeOfComplaints']['Tag']) }} ml-2">{{ policy_data['InsurerDetails']['VolumeOfComplaints']['Tag'] }}</span>
                </p>
                <p class="mb-1"><strong>Solvency Ratio:</strong> {{ policy_data['InsurerDetails']['SolvencyRatio']['Value'] }}
                    <span class="tag {{ get_score_color(policy_data['InsurerDetails']['SolvencyRatio']['Tag']) }} ml-2">{{ policy_data['InsurerDetails']['SolvencyRatio']['Tag'] }}</span>
                </p>
                <p class="mb-1"><strong>Pay-Out Ratio:</strong> {{ policy_data['InsurerDetails']['PayOutRatio']['Value'] }}
                    <span class="tag {{ get_score_color(policy_data['InsurerDetails']['PayOutRatio']['Tag']) }} ml-2">{{ policy_data['InsurerDetails']['PayOutRatio']['Tag'] }}</span>
                </p>
            </div>
            {% if scores %}
            <div class="min-w-[220px] mt-6 md:mt-0">
                <div class="bg-white rounded-xl shadow p-6 text-center">
                    <div class="font-semibold mb-2 text-gray-700">Policy Scores</div>
                    {% set score_items = [
                        ('Overall', scores['overall_score']),
                        ('Insurer', scores['insurer_rating']),
                        ('Features', scores['feature_rating']),
                        ('Affordability', scores['affordability_rating'])
                    ] %}
                    <div class="flex flex-col gap-3">
                    {% for label, value in score_items %}
                        <div class="flex items-center justify-end gap-3">
                            <span class="text-base text-gray-600 min-w-[90px] text-right font-bold">{{ label }}</span>
                            {{ score_ring(value) }}
                        </div>
                    {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="card bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-bold mb-4">Policy Features</h2>
        <h3 class="text-lg font-semibold mb-2">Mandatory Features</h3>
        {% for feature in mandatory_features %}
            <div class="card bg-gray-50 rounded-lg shadow-sm p-4 mb-4">
                <div class="feature-title flex items-center text-base font-semibold mb-2">
                    <span class="material-icons feature-icon text-blue-700 mr-2">verified_user</span>
                    {{ feature['FeatureName'] }}
                </div>
                <p class="mb-1"><strong>Offered:</strong> <span class="tag {{ get_score_color(feature['FeatureOffered']) }} ml-2">{{ feature['FeatureOffered'] }}</span></p>
                <div class="explanation text-gray-700 mb-1">{{ feature['Explanation'] }}</div>
                <div class="details text-gray-600 mb-1"><strong>Details:</strong> {{ feature['Details'] }}</div>
                <div class="why-matters text-blue-700 italic mb-1"><strong>Why this matters:</strong> {{ feature['why_matters'] }}</div>
                <div class="caveats text-red-600 mb-1"><strong>Caveats:</strong> {{ feature['Caveats'] }}</div>
                {% if feature.youtube_video %}
                <div class="my-3">
                    <iframe width="360" height="203"
                        src="https://www.youtube.com/embed/{{ feature.youtube_video.split('youtu.be/')[-1] }}"
                        title="YouTube video"
                        frameborder="0"
                        allowfullscreen
                        class="rounded-lg mx-auto block border border-gray-200 shadow-sm"></iframe>
                </div>
                {% endif %}
            </div>
        {% endfor %}
        <h3 class="text-lg font-semibold mt-6 mb-2">Good To Have Features</h3>
        {% for feature in good_features %}
            <div class="card bg-gray-50 rounded-lg shadow-sm p-4 mb-4">
                <div class="feature-title flex items-center text-base font-semibold mb-2">
                    <span class="material-icons feature-icon text-yellow-600 mr-2">star_rate</span>
                    {{ feature['FeatureName'] }}
                </div>
                <p class="mb-1"><strong>Offered:</strong> <span class="tag {{ get_score_color(feature['FeatureOffered']) }} ml-2">{{ feature['FeatureOffered'] }}</span></p>
                <div class="explanation text-gray-700 mb-1">{{ feature['Explanation'] }}</div>
                <div class="details text-gray-600 mb-1"><strong>Details:</strong> {{ feature['Details'] }}</div>
                <div class="why-matters text-blue-700 italic mb-1"><strong>Why this matters:</strong> {{ feature['why_matters'] }}</div>
                <div class="caveats text-red-600 mb-1"><strong>Caveats:</strong> {{ feature['Caveats'] }}</div>
                {% if feature.youtube_video %}
                <div class="my-3">
                    <iframe width="360" height="203"
                        src="https://www.youtube.com/embed/{{ feature.youtube_video.split('youtu.be/')[-1] }}"
                        title="YouTube video"
                        frameborder="0"
                        allowfullscreen
                        class="rounded-lg mx-auto block border border-gray-200 shadow-sm"></iframe>
                </div>
                {% endif %}
            </div>
        {% endfor %}
        <button class="action-btn bg-pink-700 hover:bg-pink-800 text-white font-semibold py-3 px-8 rounded-lg mt-6">Get Quote</button>
    </div>
    {% else %}
    <div class="card bg-red-50 text-center text-red-700 font-semibold py-8">
        No policy available for the selected insurer.
    </div>
    {% endif %}
</div>
{% endblock %}
